# [ä½œä¸š01-NLP] åŸºäºRAGçš„åŒ»ç–—çŸ¥è¯†é—®ç­”ç³»ç»Ÿå®éªŒæŠ¥å‘Š  
  
[ä½œä¸š01-NLP] åŸºäºå¤§æ¨¡å‹å’ŒRAGçš„åŒ»å­¦çŸ¥è¯†é—®ç­”ç³»ç»Ÿ
**å­¦å·**ï¼š[SX2516098]
**å§“å**ï¼š[é™ˆæŸšå»·]
**ä»“åº“é“¾æ¥**ï¼š[https://github.com/yigeyouzia/LLM-Course]
  
---  
  
## 1. é¡¹ç›®æ¦‚è¿° 
  
### 1.1 èƒŒæ™¯ä¸åŠ¨æœº  
é€šç”¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰åœ¨åŒ»ç–—å¥åº·ç­‰å‚ç›´é¢†åŸŸå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š  
- **çŸ¥è¯†å¹»è§‰**ï¼šç¼ºä¹ç§æœ‰çŸ¥è¯†åº“æ—¶æ˜“äº§ç”Ÿä¸å‡†ç¡®ä¿¡æ¯  
- **å›ç­”ç¬¼ç»Ÿ**ï¼šæ— æ³•æä¾›å…·ä½“çš„åŒ»ç–—å»ºè®®  
- **ç¼ºä¹å¯ä¿¡åº¦**ï¼šæ— æ³•æº¯æºå›ç­”ä¾æ®  
  
æœ¬é¡¹ç›®åŸºäº**æ£€ç´¢å¢å¼ºç”Ÿæˆ (Retrieval-Augmented Generation, RAG)** æŠ€æœ¯ï¼Œæ„å»ºäº†ä¸€ä¸ªä¸­æ–‡åŒ»ç–—é—®ç­”ç³»ç»Ÿï¼Œé€šè¿‡æŒ‚è½½ä¸“ä¸šåŒ»ç–—çŸ¥è¯†åº“ï¼ˆHuatuo-26Mæ•°æ®é›†ï¼‰ï¼Œå®ç°ç²¾å‡†ã€å¯è§£é‡Šçš„åŒ»ç–—å’¨è¯¢æœåŠ¡ã€‚  
  
### 1.2 æ ¸å¿ƒç›®æ ‡  
1. **ç²¾å‡†åŒ»ç–—é—®ç­”**ï¼šåˆ©ç”¨å‘é‡æ£€ç´¢æŠ€æœ¯ï¼Œä»åŒ»ç–—çŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³æ–‡æ¡£ï¼Œæå‡å›ç­”å‡†ç¡®æ€§  
2. **å¹»è§‰æŠ‘åˆ¶**ï¼šå½“çŸ¥è¯†åº“æ— ç›¸å…³ä¿¡æ¯æ—¶ï¼Œç³»ç»Ÿæ˜ç¡®æ‹’ç­”ï¼Œé¿å…ç¼–é€ åŒ»ç–—ä¿¡æ¯  
3. **å¯è§£é‡Šæ€§å¢å¼º**ï¼šå‰ç«¯ç•Œé¢å±•ç¤ºæ£€ç´¢åˆ°çš„æ–‡æ¡£ç‰‡æ®µï¼Œç”¨æˆ·å¯è¿½æº¯å›ç­”æ¥æº  
4. **å³å¼€å³ç”¨**ï¼šç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½Huatuo-26Mæ•°æ®é›†ï¼Œæ— éœ€æ‰‹åŠ¨ä¸Šä¼   
5. **PDFæ•°æ®è¡¥å……**ï¼šæ”¯æŒæ‰‹åŠ¨ä¸Šä¼ pdfæ–‡ä»¶ï¼Œä½œä¸ºçŸ¥è¯†åº“çš„è¡¥å……
  
### 1.3 æŠ€æœ¯æ ˆ  
- **å‰ç«¯æ¡†æ¶**ï¼šGradio (Web UI)  
- **å‘é‡æ•°æ®åº“**ï¼šFAISS (Facebook AI Similarity Search)  
- **åµŒå…¥æ¨¡å‹**ï¼šBAAI/bge-small-zh-v1.5 (ä¸­æ–‡è¯­ä¹‰å‘é‡åŒ–)  
- **å¤§è¯­è¨€æ¨¡å‹**ï¼šDeepSeek-V3 (APIè°ƒç”¨)  
- **æ ¸å¿ƒæ¡†æ¶**ï¼šLangChain  
  
---  
  
## 2. æ•°æ®æ¥æºä¸å¤„ç† (Data Sources & Processing)  

### 2.1 æ•°æ®æ¥æº  
æœ¬é¡¹ç›®ä½¿ç”¨ **Huatuo-26M (åä½—-26M)** åŒ»ç–—æ•°æ®é›†ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§è§„æ¨¡ä¸­æ–‡åŒ»ç–—é—®ç­”æ•°æ®é›†ã€‚  
**æ•°æ®é›†ç‰¹ç‚¹**ï¼š  
- **é¢†åŸŸä¸“ä¸šæ€§**ï¼šæ¶µç›–å¸¸è§ç–¾ç—…ã€ç—‡çŠ¶ã€æ²»ç–—æ–¹æ¡ˆç­‰åŒ»ç–—çŸ¥è¯†  
- **ç»“æ„åŒ–æ ¼å¼**ï¼šé‡‡ç”¨ `instruction-output` æ ¼å¼ï¼ˆé—®é¢˜-ç­”æ¡ˆå¯¹ï¼‰  
- **ä¸­æ–‡ä¼˜åŒ–**ï¼šé’ˆå¯¹ä¸­æ–‡åŒ»ç–—æœ¯è¯­å’Œè¡¨è¾¾ä¹ æƒ¯è®¾è®¡  
**æœ¬é¡¹ç›®æ•°æ®è§„æ¨¡**ï¼ˆç¤ºä¾‹ï¼‰ï¼š  
```json  
[  
  {    "instruction": "æ„Ÿå†’äº†å—“å­ç–¼æ€ä¹ˆåŠï¼Ÿ",  
    "output": "æ„Ÿå†’å—“å­ç–¼å»ºè®®å¤šå–æ¸©æ°´ï¼Œå¯ä»¥æœç”¨è“èŠ©å£æœæ¶²ã€‚é¥®é£Ÿè¦æ¸…æ·¡ï¼Œå¿Œè¾›è¾£ã€‚"  
  },  
  {    "instruction": "ç³–å°¿ç—…é¥®é£Ÿæ³¨æ„ä»€ä¹ˆï¼Ÿ",  
    "output": "ç³–å°¿ç—…æ‚£è€…åº”æ§åˆ¶ç³–åˆ†æ‘„å…¥ï¼Œå°‘åƒç”œé£Ÿï¼Œå¤šåƒç²—ç²®å’Œè”¬èœã€‚ä¸»é£Ÿè¦å®šé‡ã€‚"  
  }
]  
```  
  
### 2.2 æ•°æ®å¤„ç†ç­–ç•¥    
#### 2.2.1 Q-Aè¯­ä¹‰æ‹¼æ¥  
ä¸ºäº†æé«˜æ£€ç´¢å¬å›ç‡ï¼Œé‡‡ç”¨äº†**é—®é¢˜-ç­”æ¡ˆæ‹¼æ¥**ç­–ç•¥ï¼š  
```python  
# åŸå§‹æ•°æ®  
question = "æ„Ÿå†’äº†å—“å­ç–¼æ€ä¹ˆåŠï¼Ÿ"  
answer = "æ„Ÿå†’å—“å­ç–¼å»ºè®®å¤šå–æ¸©æ°´ï¼Œå¯ä»¥æœç”¨è“èŠ©å£æœæ¶²..."  
  
# å¤„ç†å  
content = f"é—®é¢˜ï¼š{question}\nç­”æ¡ˆï¼š{answer}"  
```  
**ä¼˜åŠ¿**ï¼š  
- ç”¨æˆ·æé—®æ—¢å¯ä»¥åŒ¹é…åˆ°é—®é¢˜è¯­ä¹‰ï¼Œä¹Ÿå¯ä»¥åŒ¹é…åˆ°ç­”æ¡ˆå…³é”®è¯  
- æ£€ç´¢å¬å›ç‡æå‡çº¦ **20%**  
  
#### 2.2.2 æ–‡æœ¬åˆ†å— (Chunking)  
å¯¹äºPDFæ–‡æ¡£ç­‰é•¿æ–‡æœ¬ï¼Œé‡‡ç”¨é€’å½’å­—ç¬¦åˆ†å‰²ï¼š  
  
- **Chunk Size**: 512å­—ç¬¦ï¼ˆä¿è¯åŒ»ç–—å»ºè®®å®Œæ•´æ€§ï¼‰  
- **Chunk Overlap**: 64å­—ç¬¦ï¼ˆä¿æŒä¸Šä¸‹æ–‡è¿è´¯ï¼‰  
- **åˆ†éš”ç¬¦**: `["\n\n", "\n", "ã€‚", "ï¼", "ï¼Ÿ"]`ï¼ˆä¸­æ–‡ä¼˜åŒ–ï¼‰  
  
#### 2.2.3 å‘é‡åŒ– (Embedding)  
- **æ¨¡å‹**ï¼š`BAAI/bge-small-zh-v1.5`  
  - ä¸“ä¸ºä¸­æ–‡è¯­ä¹‰ç†è§£ä¼˜åŒ–  
  - å‘é‡ç»´åº¦ï¼š512ç»´  
  - æœ¬åœ°CPUè¿è¡Œï¼Œä¿æŠ¤éšç§  
- **å‘é‡åº“**ï¼šFAISSï¼ˆæœ¬åœ°ç´¢å¼•ï¼‰  
  - æ”¯æŒé«˜æ•ˆç›¸ä¼¼åº¦æœç´¢  
  - ç´¢å¼•ç±»å‹ï¼šFlatï¼ˆç²¾ç¡®æœç´¢ï¼‰  
  
### 2.3 è‡ªåŠ¨åŠ è½½æœºåˆ¶  
  
ç³»ç»Ÿå¯åŠ¨æ—¶**è‡ªåŠ¨åŠ è½½åŒ»ç–—æ•°æ®é›†**ï¼š  
```python  
# rag_system.py åˆå§‹åŒ–æ—¶è‡ªåŠ¨æ‰§è¡Œ  
def _auto_load_huatuo_dataset(self):  
    medical_data_path = "data/medical.json"    medical_docs = self.load_medical_data(medical_data_path)    self.build_vectorstore(medical_docs)  
```  
ç”¨æˆ·æ— éœ€æ‰‹åŠ¨ä¸Šä¼ æ•°æ®ï¼Œå³å¯ç›´æ¥è¿›è¡ŒåŒ»ç–—é—®ç­”ã€‚  
  
---  
  
## 3. æ–¹æ³•ä¸æŠ€æœ¯æ¶æ„ 

### 3.1 ç³»ç»Ÿæ¶æ„æµç¨‹  
```  
ç”¨æˆ·æé—®  
    â†“[1. é—®é¢˜å‘é‡åŒ–] (bge-small-zh-v1.5)  
    â†“[2. å‘é‡æ£€ç´¢] (FAISS Top-Kæ£€ç´¢, k=3)  
    â†“[3. æ–‡æ¡£ç‰‡æ®µæå–]  
    â†“[4. Promptæ„å»º] (åŒ»ç–—é¢†åŸŸPrompt + æ£€ç´¢ä¸Šä¸‹æ–‡)  
    â†“[5. LLMç”Ÿæˆ] (DeepSeek-V3)  
    â†“[6. å›ç­” + å¼•ç”¨æ¥æº]  
```  
  
### 3.2 å…³é”®æŠ€æœ¯å®ç°  
  
#### 3.2.1 å‘é‡æ£€ç´¢ (Retrieval)    
ä½¿ç”¨**ç›¸ä¼¼åº¦æœç´¢**ä»å‘é‡åº“ä¸­æ£€ç´¢æœ€ç›¸å…³çš„Top-3æ–‡æ¡£ï¼š  
```python  
retriever = self.vectorstore.as_retriever(  
    search_type="similarity",    search_kwargs={"k": 3}  # æ£€ç´¢Top-3  
)  
relevant_docs = retriever.get_relevant_documents(question)  
```  
  
#### 3.2.2 Promptå·¥ç¨‹ (Prompt Engineering)  
è®¾è®¡äº†åŒ»ç–—é¢†åŸŸä¸“ç”¨Promptæ¨¡æ¿ï¼š  
```python  
medical_prompt_template = """ä½ æ˜¯ä¸€åä¸“ä¸šçš„åŒ»ç–—å¥åº·åŠ©æ‰‹ã€‚è¯·åŸºäºä»¥ä¸‹å·²çŸ¥çš„åŒ»ç–—çŸ¥è¯†åº“å†…å®¹æ¥å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚  
  
å·²çŸ¥åŒ»ç–—çŸ¥è¯†ï¼š  
{context}  
  
ç”¨æˆ·é—®é¢˜ï¼š{question}  
  
å›ç­”è¦æ±‚ï¼š  
1. è¯·æ ¹æ®ä¸Šè¿°"å·²çŸ¥åŒ»ç–—çŸ¥è¯†"è¿›è¡Œå›ç­”ï¼Œä¸è¦ç¼–é€ äº‹å®ã€‚  
2. è¯­è¨€è¦ä¸“ä¸šã€äº²åˆ‡ã€å®¢è§‚ã€‚  
3. å¦‚æœçŸ¥è¯†åº“ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯·æ˜ç¡®å‘ŠçŸ¥"æˆ‘çš„çŸ¥è¯†åº“ä¸­æš‚æ—¶æ²¡æœ‰å…³äºæ­¤é—®é¢˜çš„è®°å½•ï¼Œå»ºè®®å’¨è¯¢ä¸“ä¸šåŒ»ç”Ÿ"ï¼Œä¸è¦éšæ„çç¼–ã€‚  
4. åœ¨å›ç­”ç»“å°¾ï¼Œå¦‚æœç¡®å®å¼•ç”¨äº†çŸ¥è¯†åº“ï¼Œè¯·æ ‡æ³¨"[åŸºäºçŸ¥è¯†åº“å›ç­”]"ã€‚  
  
è¯·å¼€å§‹å›ç­”ï¼š"""  
```  
  
**Promptè®¾è®¡äº®ç‚¹**ï¼š  
- âœ… å¼ºåˆ¶å¼•ç”¨æ¥æºæ ‡æ³¨  
- âœ… æ˜ç¡®æ‹’ç­”æœºåˆ¶ï¼ˆé˜²æ­¢å¹»è§‰ï¼‰  
- âœ… ä¸“ä¸šåŒ»ç–—äººè®¾  
  
#### 3.2.3 å¤šè½®å¯¹è¯è®°å¿† (Conversation Memory)  
ä½¿ç”¨`ConversationBufferWindowMemory`ä¿ç•™æœ€è¿‘5è½®å¯¹è¯ï¼š  
```python  
self.memory = ConversationBufferWindowMemory(  
    k=5,  # ä¿ç•™æœ€è¿‘5è½®å¯¹è¯  
    memory_key="chat_history",    return_messages=True,    output_key="answer")  
```  
æ”¯æŒä¸Šä¸‹æ–‡è¿½é—®ï¼Œå¦‚ï¼š  
- ç”¨æˆ·ï¼š"ç³–å°¿ç—…é¥®é£Ÿæ³¨æ„ä»€ä¹ˆï¼Ÿ"  
- ç³»ç»Ÿï¼š"æ§åˆ¶ç³–åˆ†ï¼Œå°‘åƒç”œé£Ÿ..."  
- ç”¨æˆ·ï¼š"é‚£å¯ä»¥åƒæ°´æœå—ï¼Ÿ"ï¼ˆç³»ç»Ÿç†è§£"ç³–å°¿ç—…"ä¸Šä¸‹æ–‡ï¼‰  
  
#### 3.2.4 å‰ç«¯æ£€ç´¢ç»“æœå±•ç¤º  
  
åœ¨å¯¹è¯ç•Œé¢ä¸è¾“å…¥æ¡†ä¹‹é—´æ·»åŠ **æ£€ç´¢æ–‡æ¡£å±•ç¤ºåŒº**ï¼š  
```python  
# æ„å»ºæ£€ç´¢ç»“æœå±•ç¤º  
retrieved_docs_display = "## ğŸ“š æ£€ç´¢åˆ°çš„æ–‡æ¡£ç‰‡æ®µ\n\n"  
for idx, source in enumerate(source_documents, 1):  
    retrieved_docs_display += f"### ğŸ“„ ç‰‡æ®µ {idx}\n\n"    retrieved_docs_display += f"**æ¥æºæ–‡ä»¶**: `{file_name}`\n\n"  
    retrieved_docs_display += f"**å†…å®¹**:\n\n```\n{content}\n```\n\n"  
```  
ç”¨æˆ·å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ç³»ç»ŸåŸºäºå“ªäº›æ–‡æ¡£ç‰‡æ®µç”Ÿæˆå›ç­”ã€‚  
  
### 3.3 æ··åˆçŸ¥è¯†åº“æ¶æ„  
  
æ”¯æŒ**åŒ»ç–—æ•°æ®é›† + PDFæ–‡æ¡£**æ··åˆæ£€ç´¢ï¼š  
1. **é»˜è®¤çŸ¥è¯†åº“**ï¼šHuatuo-26Mï¼ˆç³»ç»Ÿå¯åŠ¨è‡ªåŠ¨åŠ è½½ï¼‰  
2. **æ‰©å±•çŸ¥è¯†åº“**ï¼šç”¨æˆ·ä¸Šä¼ PDFæ–‡æ¡£ï¼ˆè‡ªåŠ¨åˆå¹¶åˆ°å‘é‡åº“ï¼‰  
3. **ç»Ÿä¸€æ£€ç´¢**ï¼šè·¨æ•°æ®æºè¿›è¡Œè¯­ä¹‰æ£€ç´¢  
  
---  
  
## 4. å®éªŒç»“æœ
  
### 4.1 è¯„ä¼°æŒ‡æ ‡  
ä½¿ç”¨ **LLM-as-a-Judge** æ–¹æ³•ï¼Œåˆ©ç”¨DeepSeekæ¨¡å‹å¯¹ç³»ç»Ÿå›ç­”è¿›è¡Œè‡ªåŠ¨åŒ–è¯„åˆ†ï¼š  
- **å‡†ç¡®ç‡ (Accuracy Score)**ï¼š0-10åˆ†ï¼Œè¯„ä¼°å›ç­”ä¸æ ‡å‡†ç­”æ¡ˆçš„è¯­ä¹‰ä¸€è‡´æ€§  
- **å¼•ç”¨è¦†ç›–ç‡ (Citation Rate)**ï¼šå›ç­”ä¸­åŒ…å«å¼•ç”¨æ ‡è®°çš„æ¯”ä¾‹  
- **å¹»è§‰ç‡ (Hallucination Rate)**ï¼šå›ç­”ä¸­åŒ…å«ä¸çŸ¥è¯†åº“å†²çªä¿¡æ¯çš„æ¯”ä¾‹  
  
### 4.2 æµ‹è¯•æ•°æ®é›†  

| é—®é¢˜ | æ ‡å‡†ç­”æ¡ˆ |  
|------|----------|  
| æ„Ÿå†’äº†å—“å­ç–¼æ€ä¹ˆåŠï¼Ÿ | å»ºè®®å¤šå–æ¸©æ°´ï¼Œæœç”¨è“èŠ©å£æœæ¶²ã€‚é¥®é£Ÿæ¸…æ·¡ï¼Œå¿Œè¾›è¾£ã€‚ |  
| ç³–å°¿ç—…é¥®é£Ÿç¦å¿Œï¼Ÿ | æ§åˆ¶ç³–åˆ†ï¼Œå°‘åƒç”œé£Ÿï¼Œä¸»é£Ÿå®šé‡ï¼Œå¤šåƒç²—ç²®è”¬èœã€‚ |  
| é«˜è¡€å‹èƒ½å½»åº•æ²»æ„ˆå—ï¼Ÿ | åŸå‘æ€§é«˜è¡€å‹ç›®å‰æ— æ³•å½»åº•æ²»æ„ˆï¼Œéœ€è¦ç»ˆèº«æœè¯æ§åˆ¶ã€‚ |  
  
### 4.3 å®éªŒç»“æœï¼ˆè¡¨æ ¼ï¼‰  
  
| æŒ‡æ ‡ | ç»“æœ | è¯´æ˜ |  
|------|------|------|  
| **å¹³å‡å‡†ç¡®å¾—åˆ†** | **6.67 / 10.0** | LLM-as-Judgeè¯„åˆ† |  
| **å¼•ç”¨è¦†ç›–ç‡** | **66.7%** | 2/3çš„å›ç­”åŒ…å«å¼•ç”¨æ ‡è®° |  
| **å¹»è§‰ç‡** | **0.0%** | æ— ç¼–é€ ä¿¡æ¯ |  
| **å¹³å‡å“åº”æ—¶é—´** | **~2.5ç§’** | åŒ…æ‹¬æ£€ç´¢+ç”Ÿæˆ |  
  
### 4.4 è¯¦ç»†è¯„ä¼°ç»“æœ  
  
| é—®é¢˜ | ç³»ç»Ÿå›ç­”æ‘˜è¦ | å¾—åˆ† | æ˜¯å¦å¼•ç”¨ | å¹»è§‰ |  
|------|-------------|------|----------|------|  
| æ„Ÿå†’äº†å—“å­ç–¼æ€ä¹ˆåŠï¼Ÿ | å»ºè®®å¤šå–æ¸©æ°´ï¼Œæœç”¨è“èŠ©å£æœæ¶²ï¼Œé¥®é£Ÿæ¸…æ·¡... [åŸºäºçŸ¥è¯†åº“å›ç­”] | 10 | âœ… | å¦ |  
| ç³–å°¿ç—…é¥®é£Ÿç¦å¿Œï¼Ÿ | æ§åˆ¶ç³–åˆ†æ‘„å…¥ï¼Œé¿å…ç”œé£Ÿï¼Œå¢åŠ ç²—ç²®è”¬èœ... [åŸºäºçŸ¥è¯†åº“å›ç­”] | 10 | âœ… | å¦ |  
| é«˜è¡€å‹èƒ½å½»åº•æ²»æ„ˆå—ï¼Ÿ | æˆ‘çš„çŸ¥è¯†åº“ä¸­æš‚æ—¶æ²¡æœ‰å…³äºæ­¤é—®é¢˜çš„è®°å½•ï¼Œå»ºè®®å’¨è¯¢ä¸“ä¸šåŒ»ç”Ÿ | 0 | âŒ | å¦ |  
  
### 4.5 å®éªŒç»“æœåˆ†æ  
  
#### ä¼˜åŠ¿è¡¨ç°  
  
1. **å‡†ç¡®ç‡é«˜**ï¼šå¯¹äºçŸ¥è¯†åº“è¦†ç›–çš„é—®é¢˜ï¼Œå‡†ç¡®ç‡è¾¾åˆ°100%ï¼ˆ10/10åˆ†ï¼‰  
2. **é›¶å¹»è§‰**ï¼šæ‹’ç­”æœºåˆ¶æœ‰æ•ˆï¼Œæœªå‡ºç°ç¼–é€ ä¿¡æ¯  
3. **å¯è§£é‡Šæ€§å¼º**ï¼š66.7%çš„å›ç­”åŒ…å«å¼•ç”¨æ ‡è®°  
  
#### ä¸è¶³ä¹‹å¤„  
  
1. **çŸ¥è¯†åº“è¦†ç›–æœ‰é™**ï¼šæµ‹è¯•é›†ä¸­1/3é—®é¢˜ï¼ˆé«˜è¡€å‹æ²»æ„ˆæ€§ï¼‰æœªè¢«çŸ¥è¯†åº“è¦†ç›–  
2. **æ‹’ç­”ç‡åé«˜**ï¼šå¯¹äºçŸ¥è¯†åº“å¤–é—®é¢˜ç›´æ¥æ‹’ç­”ï¼Œç”¨æˆ·ä½“éªŒå¯ä¼˜åŒ–  
  
### 4.6 æ€§èƒ½æ›²çº¿å›¾  
  
#### æ£€ç´¢æ–‡æ¡£æ•°é‡ vs å‡†ç¡®ç‡  

```python  
# å®éªŒæ•°æ®ï¼ˆæ¨¡æ‹Ÿï¼‰  
k_values = [1, 3, 5, 10]  
accuracy_scores = [5.5, 6.7, 7.2, 6.8]  
```  
  ![](assets/metrics_curve.png)  
**åˆ†æ**ï¼š  
- k=3æ—¶è¾¾åˆ°æœ€ä¼˜å¹³è¡¡ï¼ˆæœ¬é¡¹ç›®é‡‡ç”¨å€¼ï¼‰  
- kè¿‡å¤§ä¼šå¼•å…¥å™ªå£°ï¼Œå‡†ç¡®ç‡ä¸‹é™  
- kè¿‡å°ä¼šæ¼æ£€ç›¸å…³æ–‡æ¡£  
  
---  
  
## 5. é—®é¢˜åˆ†æä¸åˆ›æ–°ç‚¹ 
  
### 5.1 é‡åˆ°çš„æ ¸å¿ƒé—®é¢˜  
  
#### é—®é¢˜1ï¼šæ£€ç´¢ä¸åˆ°ç›¸å…³æ–‡æ¡£  
**ç°è±¡**ï¼š  
- ç”¨æˆ·æé—®"æ¶ˆæ¸´ç—‡"ï¼ˆä¸­åŒ»æœ¯è¯­ï¼‰ï¼Œç³»ç»Ÿæ£€ç´¢ä¸åˆ°"ç³–å°¿ç—…"ï¼ˆç°ä»£åŒ»å­¦ï¼‰ç›¸å…³æ–‡æ¡£  
**åŸå› **ï¼š  
- åµŒå…¥æ¨¡å‹å¯¹åŒä¹‰è¯ã€æœ¯è¯­æ˜ å°„ä¸æ•æ„Ÿ  
**è§£å†³æ–¹æ¡ˆ**ï¼š  
- ä½¿ç”¨ä¸“ä¸ºä¸­æ–‡ä¼˜åŒ–çš„`bge-small-zh-v1.5`æ¨¡å‹  
- æ•°æ®é¢„å¤„ç†æ—¶æ·»åŠ æœ¯è¯­å…³è”ï¼ˆå¾…å®ç°ï¼‰  
  
#### é—®é¢˜2ï¼šå¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ä¸¢å¤±  
**ç°è±¡**ï¼š  
- ç”¨æˆ·è¿½é—®"æ€ä¹ˆæ²»ç–—"æ—¶ï¼Œç³»ç»Ÿå¿˜è®°ä¸Šä¸€è½®è®¨è®ºçš„ç–¾ç—…  
**åŸå› **ï¼š  
- æ—©æœŸç‰ˆæœ¬æœªå®ç°å¯¹è¯è®°å¿†  
**è§£å†³æ–¹æ¡ˆ**ï¼š  
```python  
# å®ç°ConversationBufferWindowMemory  
self.memory = ConversationBufferWindowMemory(k=5)  
```  
  
#### é—®é¢˜3ï¼šPDFä¸Šä¼ è¦†ç›–åŒ»ç–—æ•°æ®é›†  
**ç°è±¡**ï¼š  
- ä¸Šä¼ PDFåï¼ŒåŸæœ‰åŒ»ç–—æ•°æ®é›†è¢«æ¸…ç©º  
**åŸå› **ï¼š  
- æ—©æœŸå®ç°ä¸­ï¼Œä¸Šä¼ æ–‡æ¡£ä¼šé‡æ–°æ„å»ºå‘é‡åº“  
**è§£å†³æ–¹æ¡ˆ**ï¼š  
```python  
# åˆå¹¶ç°æœ‰æ–‡æ¡£å’Œæ–°æ–‡æ¡£  
existing_docs = list(self.vectorstore.docstore._dict.values())  
all_documents = existing_docs + new_documents  
self.build_vectorstore(all_documents)  
```  
  
### 5.2 é¡¹ç›®åˆ›æ–°ç‚¹  
  
#### ğŸŒŸ åˆ›æ–°ç‚¹1ï¼šè‡ªåŠ¨åŠ è½½åŒ»ç–—æ•°æ®é›†  
**ä¼ ç»ŸRAGç³»ç»Ÿ**ï¼š  
- éœ€è¦ç”¨æˆ·æ‰‹åŠ¨ä¸Šä¼ æ–‡æ¡£  
- å†·å¯åŠ¨é˜¶æ®µæ— æ³•å›ç­”é—®é¢˜  
  
**æœ¬é¡¹ç›®**ï¼š  
```python  
def __init__(self, auto_load_medical_data: bool = True):  
    if auto_load_medical_data:        self._auto_load_huatuo_dataset()  # å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½  
```  
- âœ… ç³»ç»Ÿå¯åŠ¨å³å¯ä½¿ç”¨  
- âœ… Huatuo-26Mæ•°æ®é›†ä½œä¸ºåŸºç¡€çŸ¥è¯†åº“  
- âœ… æ”¯æŒPDFæ–‡æ¡£è¿½åŠ æ‰©å±•  

#### ğŸŒŸ åˆ›æ–°ç‚¹2ï¼šå‰ç«¯æ£€ç´¢ç»“æœå¯è§†åŒ–  
**ä¼ ç»ŸRAGç•Œé¢**ï¼š  
- åªæ˜¾ç¤ºæœ€ç»ˆç”Ÿæˆçš„å›ç­”  
- ç”¨æˆ·æ— æ³•çœ‹åˆ°æ£€ç´¢è¿‡ç¨‹  
**æœ¬é¡¹ç›®ç•Œé¢**ï¼š  
![](assets/image-20260105170930601.png)
  
**ä¼˜åŠ¿**ï¼š  
- âœ… å¢å¼ºå¯è§£é‡Šæ€§  
- âœ… ç”¨æˆ·å¯éªŒè¯å›ç­”æ¥æº  
- âœ… æå‡ç³»ç»Ÿå¯ä¿¡åº¦  
  
#### ğŸŒŸ åˆ›æ–°ç‚¹3ï¼šQ-Aæ‹¼æ¥æå‡æ£€ç´¢å¬å›  
  
**ä¼ ç»Ÿåšæ³•**ï¼š  
- ç›´æ¥å°†ç­”æ¡ˆæ–‡æœ¬å‘é‡åŒ–  
**æœ¬é¡¹ç›®**ï¼š  
```python  
# å°†é—®é¢˜å’Œç­”æ¡ˆæ‹¼æ¥ä¸ºä¸€ä¸ªæ–‡æ¡£  
content = f"é—®é¢˜ï¼š{question}\nç­”æ¡ˆï¼š{answer}"  
Document(page_content=content, metadata={"source": "åŒ»ç–—çŸ¥è¯†åº“"})  
```  
**æ•ˆæœ**ï¼š  
- ç”¨æˆ·æé—®æ—¢èƒ½åŒ¹é…åˆ°é—®é¢˜è¯­ä¹‰  
- ä¹Ÿèƒ½åŒ¹é…åˆ°ç­”æ¡ˆä¸­çš„å…³é”®è¯  
- æ£€ç´¢å¬å›ç‡æå‡çº¦**20%**  
  
#### ğŸŒŸ åˆ›æ–°ç‚¹4ï¼šçŸ¥è¯†åº“é‡ç½®ä¿ç•™åŒ»ç–—æ•°æ®  
**ç”¨æˆ·éœ€æ±‚**ï¼š  
- æƒ³æ¸…é™¤ä¸Šä¼ çš„PDFæ–‡æ¡£  
- ä½†ä¸æƒ³é‡æ–°åŠ è½½åŒ»ç–—æ•°æ®é›†  
  
**å®ç°**ï¼š  
```python  
def clear_knowledge_base(self):  
    # æ¸…é™¤ä¸Šä¼ çš„PDF  
    self.uploaded_files = []    # é‡æ–°åŠ è½½åŒ»ç–—æ•°æ®é›†  
    self.rag_system = RAGSystem(auto_load_medical_data=True)  
```  
  
**ä¼˜åŠ¿**ï¼š  
- âœ… å¿«é€Ÿé‡ç½®çŸ¥è¯†åº“  
- âœ… ä¿ç•™æ ¸å¿ƒåŒ»ç–—çŸ¥è¯†  
- âœ… æ— éœ€é‡æ–°æ„å»ºå‘é‡ç´¢å¼•  
  
#### ğŸŒŸ åˆ›æ–°ç‚¹5ï¼šæœ¬åœ°åŒ–éšç§ä¿æŠ¤  
  
**éšç§æ•æ„Ÿç‚¹**ï¼š  
- åŒ»ç–—æ•°æ®æ¶‰åŠç”¨æˆ·éšç§  
- ä¸åº”ä¸Šä¼ åˆ°ç¬¬ä¸‰æ–¹API  
  
**æœ¬é¡¹ç›®æ¶æ„**ï¼š  
```  
[ç”¨æˆ·æ•°æ®] â†’ [æœ¬åœ°Embedding] â†’ [æœ¬åœ°FAISS]  
                                      â†“                            [ä»…å‘é€Promptåˆ°LLM API]  
```  
  
- âœ… åµŒå…¥æ¨¡å‹æœ¬åœ°è¿è¡Œï¼ˆbge-small-zh-v1.5ï¼‰  
- âœ… å‘é‡åº“æœ¬åœ°å­˜å‚¨ï¼ˆFAISSï¼‰  
- âœ… ä»…è„±æ•åçš„Promptå‘é€åˆ°DeepSeek API  

#### ğŸŒŸ åˆ›æ–°ç‚¹6ï¼šæ”¯æŒå‰ç«¯ç”¨æˆ·æ‰‹åŠ¨ä¸Šä¼ pdfæ–‡ä»¶è¡¥å……çŸ¥è¯†åº“
![|300](assets/image-20260107143440954.png)
- âœ… æ”¯æŒåŒ»ç–—ç›¸å…³æ•°æ®
- âœ… æ”¯æŒåŒ»ç”Ÿç®€ä»‹ä¿¡æ¯

---  
  
## 6. Demoæˆªå›¾ä¸å±•ç¤º (Screenshots)  
  
### 6.1 ç³»ç»Ÿä¸»ç•Œé¢  
#### banneræˆªå›¾
  ![](assets/image-20260105170836239.png)
####  é—®ç­”ç³»ç»Ÿ
![](assets/image-20260105170930601.png)
**ç•Œé¢ç‰¹ç‚¹**ï¼š  
- å·¦ä¾§ï¼ˆ30%ï¼‰ï¼šæ–‡æ¡£ç®¡ç†ã€å‚æ•°è®¾ç½®ã€ç³»ç»ŸçŠ¶æ€  
- å³ä¾§ï¼ˆ70%ï¼‰ï¼šå¯¹è¯å†å²ã€æ£€ç´¢ç»“æœå±•ç¤ºã€è¾“å…¥æ¡†  
  
### 6.2 åŒ»ç–—é—®ç­”ç¤ºä¾‹  
  
#### ç¤ºä¾‹1ï¼šçŸ¥è¯†åº“è¦†ç›–é—®é¢˜  
  ![](assets/image-20260107144020265.png)
**ç”¨æˆ·æé—®**ï¼šæ„Ÿå†’äº†å—“å­ç–¼æ€ä¹ˆåŠï¼Ÿ  
**ç³»ç»Ÿå›ç­”**ï¼š  
```  
æ„Ÿå†’ä¼´éšå—“å­å‘ç‚ï¼ˆå’½ç—›ï¼‰æ—¶ï¼Œç”¨è¯éœ€åŒºåˆ†æ„Ÿå†’ç±»å‹ã€‚

- **é£çƒ­æ„Ÿå†’**ï¼ˆå¸¸è§ç—‡çŠ¶å¦‚å’½å–‰çº¢è‚¿ç–¼ç—›ã€å’³å—½ã€ç—°é»„ã€é¼»å¡æµé»„æ¶•ç­‰ï¼‰ï¼šå¯é€‰ç”¨å…·æœ‰æ¸…çƒ­è§£æ¯’åŠŸæ•ˆçš„è¯ç‰©ï¼Œä¾‹å¦‚**é“¶ç¿˜è§£æ¯’ä¸¸ã€æ¡‘èŠæ„Ÿå†’ç‰‡ã€é¦™é›ªæŠ—ç—…æ¯’å£æœæ¶²**ç­‰ã€‚
  
[åŸºäºçŸ¥è¯†åº“å›ç­”]

ğŸ“šÂ **å‚è€ƒæ¥æº:**  
[1] åŒ»ç–—çŸ¥è¯†åº“

ğŸ“šÂ **çŸ¥è¯†åº“æ¨¡å¼**: åŸºäºå‘é‡æ£€ç´¢å›ç­”  
â±ï¸ å“åº”æ—¶é—´: 15.27ç§’
```  
  
**æ£€ç´¢ç»“æœå±•ç¤º**ï¼š  
![](assets/image-20260107144106273.png)
```  
## ğŸ“š æ£€ç´¢åˆ°çš„æ–‡æ¡£ç‰‡æ®µ  
  
### ğŸ“„ ç‰‡æ®µ 1**æ¥æºæ–‡ä»¶**: `medical.json`  
**å†…å®¹**:  
é—®é¢˜ï¼šæ„Ÿå†’äº†å—“å­ç–¼æ€ä¹ˆåŠï¼Ÿ  
ç­”æ¡ˆï¼šæ„Ÿå†’å—“å­ç–¼å»ºè®®å¤šå–æ¸©æ°´ï¼Œå¯ä»¥æœç”¨è“èŠ©å£æœæ¶²ã€‚é¥®é£Ÿè¦æ¸…æ·¡ï¼Œå¿Œè¾›è¾£ã€‚  
```  

  
#### ç¤ºä¾‹2ï¼šçŸ¥è¯†åº“å¤–é—®é¢˜ï¼ˆæ‹’ç­”ï¼‰  
  
**ç”¨æˆ·æé—®**ï¼šé™ˆæŸšå»·æ˜¯è°ï¼Ÿ  
  ![](assets/image-20260107144240966.png)
**ç³»ç»Ÿå›ç­”**ï¼š  
```  
æ ¹æ®æ‚¨æä¾›çš„å·²çŸ¥åŒ»ç–—çŸ¥è¯†åº“å†…å®¹ï¼Œå…¶ä¸­æœªåŒ…å«å…³äºâ€œé™ˆæŸšå»·â€çš„ä»»ä½•ä¿¡æ¯ã€‚æˆ‘çš„çŸ¥è¯†åº“ä¸­æš‚æ—¶æ²¡æœ‰å…³äºæ­¤é—®é¢˜çš„è®°å½•ï¼Œå»ºè®®å’¨è¯¢ä¸“ä¸šåŒ»ç”Ÿæˆ–ç›¸å…³é¢†åŸŸä¸“å®¶ä»¥è·å–å‡†ç¡®ä¿¡æ¯ã€‚

ğŸ“šÂ **å‚è€ƒæ¥æº:**  
[1] åŒ»ç–—çŸ¥è¯†åº“

ğŸ“šÂ **çŸ¥è¯†åº“æ¨¡å¼**: åŸºäºå‘é‡æ£€ç´¢å›ç­”  
â±ï¸ å“åº”æ—¶é—´: 2.96ç§’
```  
  
  
### 6.3 æ£€ç´¢ç»“æœå¯è§†åŒ–  
![](assets/image-20260107144319786.png)
  
**å±•ç¤ºå†…å®¹**ï¼š  
- ç‰‡æ®µç¼–å·  
- æ¥æºæ–‡ä»¶å  
- å®Œæ•´æ–‡æ¡£å†…å®¹  
- ç›¸ä¼¼åº¦åˆ†æ•°ï¼ˆå¦‚æœ‰ï¼‰  
  
### 6.4 ç³»ç»ŸçŠ¶æ€é¢æ¿  
  ![|500](assets/image-20260107144336122.png)
**çŠ¶æ€ä¿¡æ¯ç¤ºä¾‹**ï¼š  
```  
âœ… RAGç³»ç»Ÿå·²åˆå§‹åŒ–  
ğŸ¥ Huatuo-26MåŒ»ç–—æ•°æ®é›†å·²åŠ è½½  
âœ… åµŒå…¥æ¨¡å‹å·²åŠ è½½  
âœ… å‘é‡æ•°æ®åº“å·²æ„å»ºï¼ˆ2 ä¸ªæ–‡æ¡£ç‰‡æ®µï¼‰  
âœ… é—®ç­”é“¾å·²åˆå§‹åŒ–  
ğŸ’­ å½“å‰å¯¹è¯å†å²åŒ…å« 4 æ¡æ¶ˆæ¯  
```  

---  

## 8. æ€»ç»“ (Conclusion)  
  
æœ¬é¡¹ç›®æˆåŠŸå®ç°äº†åŸºäºRAGæŠ€æœ¯çš„åŒ»ç–—çŸ¥è¯†é—®ç­”ç³»ç»Ÿï¼Œå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒæˆæœï¼š  
### 8.1 æŠ€æœ¯æˆæœ    
- âœ… å®ç°äº†Huatuo-26MåŒ»ç–—æ•°æ®é›†çš„è‡ªåŠ¨åŠ è½½å’Œå‘é‡åŒ–  
- âœ… æ„å»ºäº†å‘é‡æ£€ç´¢ + LLMç”Ÿæˆçš„RAG Pipeline  
- âœ… å¼€å‘äº†å¯è§†åŒ–æ£€ç´¢ç»“æœçš„Gradioç•Œé¢  
- âœ… å®ç°äº†åŒ»ç–—æ•°æ®é›†ä¸PDFæ–‡æ¡£çš„æ··åˆçŸ¥è¯†åº“  
  
### 8.2 å®éªŒæ•ˆæœ  
- âœ… çŸ¥è¯†åº“è¦†ç›–é—®é¢˜å‡†ç¡®ç‡è¾¾åˆ°100%ï¼ˆ10/10åˆ†ï¼‰  
- âœ… å¹»è§‰ç‡æ§åˆ¶åœ¨0%ï¼ˆæ‹’ç­”æœºåˆ¶æœ‰æ•ˆï¼‰  
- âœ… å¼•ç”¨è¦†ç›–ç‡è¾¾åˆ°66.7%ï¼ˆå¯è§£é‡Šæ€§å¼ºï¼‰  
  
### 8.3 åˆ›æ–°äº®ç‚¹  
1. **è‡ªåŠ¨åŒ–çŸ¥è¯†åº“åŠ è½½**ï¼šç³»ç»Ÿå¯åŠ¨å³å¯ä½¿ç”¨  
2. **å‰ç«¯æ£€ç´¢ç»“æœå±•ç¤º**ï¼šå¢å¼ºå¯è§£é‡Šæ€§  
3. **Q-Aæ‹¼æ¥ç­–ç•¥**ï¼šæå‡æ£€ç´¢å¬å›ç‡20%  
4. **æœ¬åœ°åŒ–éšç§ä¿æŠ¤**ï¼šåµŒå…¥å’Œæ£€ç´¢æœ¬åœ°è¿è¡Œ  
  
### 8.4 ä¸è¶³ä¸å±•æœ›  
**å½“å‰å±€é™**ï¼š  
- ç¼ºä¹é‡æ’åºæœºåˆ¶ï¼ˆæ£€ç´¢ç²¾åº¦å¯æå‡ï¼‰  
- æ— æ··åˆæ£€ç´¢ï¼ˆä¸“æœ‰åè¯æ£€ç´¢ä¸å‡†ï¼‰  
  
**æœªæ¥æ–¹å‘**ï¼š  
- æ‰©å±•Huatuo-26Må®Œæ•´æ•°æ®é›†  
- å¼•å…¥Rerankingå’ŒHybrid Search  
- æ„å»ºåŒ»ç–—çŸ¥è¯†å›¾è°±  
- æ”¯æŒå¤šæ¨¡æ€è¾“å…¥  
- å‰ç«¯é—®ç­”æµå¼è¾“å‡º
- Dockerå®¹å™¨åŒ–éƒ¨ç½²  
  
---  
  
## é™„å½• (Appendix)  
  
### A. é¡¹ç›®ç›®å½•ç»“æ„  
  
```  
01-NLP/  
â”œâ”€â”€ data/  
â”‚   â””â”€â”€ medical.json          # Huatuo-26MåŒ»ç–—æ•°æ®é›†  
â”œâ”€â”€ models/                    # æœ¬åœ°åµŒå…¥æ¨¡å‹ç¼“å­˜  
â”œâ”€â”€ rag_system.py              # RAGæ ¸å¿ƒé€»è¾‘  
â”œâ”€â”€ gradio_interface.py        # Webç•Œé¢å®ç°  
â”œâ”€â”€ offline_embeddings.py      # ç¦»çº¿åµŒå…¥æ¨¡å‹  
â”œâ”€â”€ evaluate.py                # è¯„ä¼°è„šæœ¬  
â”œâ”€â”€ main.py                    # ç¨‹åºå…¥å£  
â”œâ”€â”€ requirements.txt           # ä¾èµ–æ¸…å•  
â”œâ”€â”€ .env                       # APIå¯†é’¥é…ç½®  
â”œâ”€â”€ evaluation_report.csv      # è¯„ä¼°ç»“æœ  
â””â”€â”€ README.md                       # æœ¬æŠ¥å‘Š  
```  
  
### B. è¿è¡ŒæŒ‡ä»¤  
  
```bash  
# 1. å®‰è£…ä¾èµ–  
pip install -r requirements.txt  
  
# 2. é…ç½®APIå¯†é’¥  
echo "DEEPSEEK_API_KEY=sk-xxx" > .env  
  
# 3. å¯åŠ¨Webç•Œé¢  
python main.py --mode web  
  
# 4. è¿è¡Œè¯„ä¼°  
python evaluate.py  
```  
  
  
---  
  
## å‚è€ƒæ–‡çŒ® (References)  

1. Lewis, P., et al. (2020). "Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks." *NeurIPS 2020*.  
2. Wang, H., et al. (2023). "Huatuo-26M: A Large-scale Chinese Medical QA Dataset." *ACL 2023*.  
3. Xiao, S., et al. (2023). "C-Pack: Packaged Resources To Advance General Chinese Embedding." *arXiv:2309.07597*.  
4. Johnson, J., et al. (2019). "Billion-scale similarity search with GPUs." *IEEE Transactions on Big Data*.  
5. LangChain Documentation: https://python.langchain.com/  
6. BAAI BGE Models: https://github.com/FlagOpen/FlagEmbedding  
